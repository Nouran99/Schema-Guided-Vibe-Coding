{
  "files": [
    {
      "filename": "index.html",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Chat App</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }\n        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }\n        input, button, select { margin: 5px; padding: 8px; width: calc(100% - 20px); }\n        button { background: #007bff; color: white; border: none; cursor: pointer; }\n        button:hover { background: #0056b3; }\n        #messages { height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-top: 10px; }\n        #typingIndicator { color: #666; font-style: italic; }\n        #status { color: green; }\n    </style>\n</head>\n<body>\n    <h1>Chat App</h1>\n    <div class=\"section\">\n        <h3>Auth</h3>\n        <input id=\"username\" placeholder=\"Username\">\n        <input id=\"password\" type=\"password\" placeholder=\"Password\">\n        <button onclick=\"register()\">Register</button>\n        <button onclick=\"login()\">Login</button>\n        <p id=\"authStatus\">Not logged in</p>\n    </div>\n    <div class=\"section\">\n        <h3>Rooms</h3>\n        <input id=\"roomName\" placeholder=\"Room name\">\n        <button onclick=\"createRoom()\">Create Room</button>\n        <button onclick=\"listRooms()\">List Rooms</button>\n        <select id=\"roomSelect\" onchange=\"joinRoom()\">\n            <option value=\"\">Select a room</option>\n        </select>\n        <p id=\"unreadCount\">Unread: 0</p>\n    </div>\n    <div class=\"section\">\n        <h3>Chat</h3>\n        <p id=\"currentRoom\">No room selected</p>\n        <p id=\"status\">Status: offline</p>\n        <input id=\"messageInput\" placeholder=\"Type message\" oninput=\"sendTyping()\">\n        <button onclick=\"sendMessage()\">Send</button>\n        <input type=\"file\" id=\"fileInput\">\n        <button onclick=\"uploadFile()\">Upload File</button>\n        <div id=\"typingIndicator\"></div>\n        <div id=\"messages\"></div>\n    </div>\n    <script>\n        let token = '';\n        let currentRoom = null;\n        let ws = null;\n        let unreadCount = 0;\n        const baseUrl = 'http://localhost:8000';\n        \n        async function apiCall(endpoint, method='GET', body=null) {\n            const headers = { 'Content-Type': 'application/json' };\n            if (token) headers['Authorization'] = `Bearer ${token}`;\n            try {\n                const res = await fetch(`${baseUrl}${endpoint}`, {\n                    method, headers, body: body ? JSON.stringify(body) : null\n                });\n                return await res.json();\n            } catch (e) {\n                console.error('API call failed:', e);\n                return {};\n            }\n        }\n        \n        async function register() {\n            const user = document.getElementById('username').value;\n            const pass = document.getElementById('password').value;\n            const res = await apiCall('/api/auth/register', 'POST', { username: user, password: pass });\n            document.getElementById('authStatus').textContent = res.message || 'Registered';\n        }\n        \n        async function login() {\n            const user = document.getElementById('username').value;\n            const pass = document.getElementById('password').value;\n            const res = await apiCall('/api/auth/login', 'POST', { username: user, password: pass });\n            token = res.access_token || '';\n            document.getElementById('authStatus').textContent = token ? 'Logged in' : 'Login failed';\n            if (token) connectWebSocket(user);\n        }\n        \n        function connectWebSocket(username) {\n            ws = new WebSocket(`ws://localhost:8000/ws/${username}`);\n            ws.onmessage = (event) => {\n                const data = JSON.parse(event.data);\n                if (data.type === 'message') {\n                    document.getElementById('messages').innerHTML += `<p><strong>${data.user}:</strong> ${data.content}</p>`;\n                    if (data.room_id != currentRoom) {\n                        unreadCount++;\n                        document.getElementById('unreadCount').textContent = `Unread: ${unreadCount}`;\n                    }\n                } else if (data.type === 'typing') {\n                    document.getElementById('typingIndicator').textContent = `${data.user} is typing...`;\n                    setTimeout(() => document.getElementById('typingIndicator').textContent = '', 1000);\n                } else if (data.type === 'status') {\n                    document.getElementById('status').textContent = `Status: ${data.status}`;\n                }\n            };\n        }\n        \n        async function createRoom() {\n            const name = document.getElementById('roomName').value;\n            const res = await apiCall('/api/rooms', 'POST', { name });\n            alert(res.message || 'Room created');\n            listRooms();\n        }\n        \n        async function listRooms() {\n            const res = await apiCall('/api/rooms');\n            const select = document.getElementById('roomSelect');\n            select.innerHTML = '<option value=\"\">Select a room</option>';\n            res.forEach(r => {\n                const option = document.createElement('option');\n                option.value = r.id;\n                option.textContent = r.name;\n                select.appendChild(option);\n            });\n        }\n        \n        async function joinRoom() {\n            const roomId = document.getElementById('roomSelect').value;\n            if (!roomId) return;\n            const res = await apiCall(`/api/rooms/${roomId}/join`, 'POST');\n            currentRoom = roomId;\n            document.getElementById('currentRoom').textContent = `Room: ${roomId}`;\n            loadMessages(roomId);\n            unreadCount = 0;\n            document.getElementById('unreadCount').textContent = 'Unread: 0';\n        }\n        \n        async function loadMessages(roomId) {\n            const res = await apiCall(`/api/rooms/${roomId}/messages`);\n            document.getElementById('messages').innerHTML = res.map(m => `<p><strong>${m.user_id}:</strong> ${m.content}</p>`).join('');\n        }\n        \n        function sendTyping() {\n            if (ws && ws.readyState === WebSocket.OPEN) {\n                ws.send(JSON.stringify({ type: 'typing', room_id: currentRoom }));\n            }\n        }\n        \n        async function sendMessage() {\n            if (!currentRoom) return alert('Join a room first');\n            const msg = document.getElementById('messageInput').value;\n            if (ws && ws.readyState === WebSocket.OPEN) {\n                ws.send(JSON.stringify({ type: 'message', room_id: currentRoom, content: msg }));\n            }\n            document.getElementById('messageInput').value = '';\n        }\n        \n        async function uploadFile() {\n            const fileInput = document.getElementById('fileInput');\n            const file = fileInput.files[0];\n            if (!file) return;\n            const formData = new FormData();\n            formData.append('file', file);\n            try {\n                const res = await fetch(`${baseUrl}/api/upload`, { method: 'POST', body: formData });\n                const data = await res.json();\n                alert('File uploaded: ' + data.url);\n            } catch (e) {\n                console.error('Upload failed:', e);\n            }\n        }\n    </script>\n</body>\n</html>",
      "description": "Minimal chat frontend with JWT auth, WebSocket for real-time messaging, typing indicators, unread counts, user status, and file upload"
    }
  ],
  "setup_instructions": "Open index.html in browser after starting backend with: pip install fastapi uvicorn pyjwt websockets && uvicorn main:app --reload"
}