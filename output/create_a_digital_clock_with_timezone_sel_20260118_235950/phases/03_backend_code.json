{
  "files": [
    {
      "filename": "main.py",
      "content": "from fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom datetime import datetime\nimport pytz\nfrom typing import Dict, List\nimport tzlocal\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\nTIMEZONES = [\n    {\"label\": \"UTC-5: New York\", \"value\": \"America/New_York\"},\n    {\"label\": \"UTC+0: London\", \"value\": \"Europe/London\"},\n    {\"label\": \"UTC+1: Berlin\", \"value\": \"Europe/Berlin\"},\n    {\"label\": \"UTC+8: Beijing\", \"value\": \"Asia/Shanghai\"},\n    {\"label\": \"UTC+9: Tokyo\", \"value\": \"Asia/Tokyo\"},\n]\n\nuser_settings: Dict[str, Dict] = {}\nlocal_tz = tzlocal.get_localzone_name()\n\ndef get_current_time(timezone: str, hour_format: str) -> Dict:\n    try:\n        tz = pytz.timezone(timezone)\n        now = datetime.now(tz)\n        if hour_format == \"12\":\n            hour = now.strftime(\"%I\")\n            am_pm = now.strftime(\"%p\")\n            time_str = f\"{hour}:{now.strftime('%M:%S')} {am_pm}\"\n        else:\n            time_str = now.strftime(\"%H:%M:%S\")\n        return {\n            \"hour\": int(now.strftime(\"%H\")),\n            \"minute\": int(now.strftime(\"%M\")),\n            \"second\": int(now.strftime(\"%S\")),\n            \"formatted\": time_str,\n            \"timezone\": timezone,\n        }\n    except Exception:\n        raise HTTPException(status_code=400, detail=\"Invalid timezone\")\n\n@app.get(\"/api/current-time\")\ndef get_time(user_id: str = \"default\", timezone: str = None, hour_format: str = None):\n    settings = user_settings.get(user_id, {\"timezone\": local_tz, \"hour_format\": \"24\"})\n    tz = timezone or settings.get(\"timezone\", local_tz)\n    fmt = hour_format or settings.get(\"hour_format\", \"24\")\n    return get_current_time(tz, fmt)\n\n@app.get(\"/api/timezones\")\ndef list_timezones() -> List[Dict]:\n    return TIMEZONES\n\n@app.get(\"/api/user-settings\")\ndef get_settings(user_id: str = \"default\"):\n    return user_settings.get(user_id, {\"timezone\": local_tz, \"hour_format\": \"24\"})\n\n@app.post(\"/api/user-settings\")\ndef update_settings(user_id: str = \"default\", timezone: str = None, hour_format: str = None):\n    if user_id not in user_settings:\n        user_settings[user_id] = {\"timezone\": local_tz, \"hour_format\": \"24\"}\n    if timezone:\n        user_settings[user_id][\"timezone\"] = timezone\n    if hour_format:\n        user_settings[user_id][\"hour_format\"] = hour_format\n    return user_settings[user_id]\n",
      "description": "Main FastAPI app with CORS, in-memory storage, local timezone detection, and core endpoints"
    }
  ],
  "setup_instructions": "pip install fastapi uvicorn pytz tzlocal && uvicorn main:app --reload"
}