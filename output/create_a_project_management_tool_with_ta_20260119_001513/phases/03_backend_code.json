{
  "files": [
    {
      "filename": "main.py",
      "content": "from fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel\nfrom datetime import datetime\nfrom typing import List, Optional\nimport uuid\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\nprojects = {}\ntasks = {}\nusers = {\"1\": {\"id\": \"1\", \"username\": \"alice\", \"email\": \"alice@example.com\"},\n         \"2\": {\"id\": \"2\", \"username\": \"bob\", \"email\": \"bob@example.com\"}}\n\nclass ProjectCreate(BaseModel):\n    name: str\n\nclass TaskCreate(BaseModel):\n    title: str\n    description: str\n    project_id: str\n    assignee_id: Optional[str] = None\n    deadline: Optional[datetime] = None\n\nclass TaskUpdate(BaseModel):\n    status: Optional[str] = None\n    assignee_id: Optional[str] = None\n    deadline: Optional[datetime] = None\n\n@app.post(\"/api/projects\")\ndef create_project(project: ProjectCreate):\n    project_id = str(uuid.uuid4())\n    projects[project_id] = {\n        \"id\": project_id,\n        \"name\": project.name,\n        \"created_at\": datetime.now(),\n        \"progress_percentage\": 0.0\n    }\n    return projects[project_id]\n\n@app.get(\"/api/projects\")\ndef get_projects():\n    return list(projects.values())\n\n@app.post(\"/api/projects/{project_id}/tasks\")\ndef add_task(project_id: str, task: TaskCreate):\n    if project_id not in projects:\n        raise HTTPException(status_code=404, detail=\"Project not found\")\n    task_id = str(uuid.uuid4())\n    tasks[task_id] = {\n        \"id\": task_id,\n        \"title\": task.title,\n        \"description\": task.description,\n        \"status\": \"todo\",\n        \"deadline\": task.deadline,\n        \"project_id\": project_id,\n        \"assignee_id\": task.assignee_id\n    }\n    return tasks[task_id]\n\n@app.put(\"/api/tasks/{task_id}\")\ndef update_task(task_id: str, updates: TaskUpdate):\n    if task_id not in tasks:\n        raise HTTPException(status_code=404, detail=\"Task not found\")\n    if updates.status:\n        if updates.status not in [\"todo\", \"in_progress\", \"done\"]:\n            raise HTTPException(status_code=400, detail=\"Invalid status\")\n        tasks[task_id][\"status\"] = updates.status\n    if updates.assignee_id is not None:\n        tasks[task_id][\"assignee_id\"] = updates.assignee_id\n    if updates.deadline is not None:\n        tasks[task_id][\"deadline\"] = updates.deadline\n    return tasks[task_id]\n\n@app.get(\"/api/tasks\")\ndef get_tasks(assignee_id: Optional[str] = None, project_id: Optional[str] = None):\n    filtered_tasks = list(tasks.values())\n    if assignee_id:\n        filtered_tasks = [t for t in filtered_tasks if t[\"assignee_id\"] == assignee_id]\n    if project_id:\n        filtered_tasks = [t for t in filtered_tasks if t[\"project_id\"] == project_id]\n    for task in filtered_tasks:\n        if task[\"deadline\"] and task[\"deadline\"] < datetime.now() and task[\"status\"] != \"done\":\n            task[\"overdue\"] = True\n        else:\n            task[\"overdue\"] = False\n    return filtered_tasks\n\n@app.get(\"/api/projects/{project_id}/tasks\")\ndef get_project_tasks(project_id: str):\n    if project_id not in projects:\n        raise HTTPException(status_code=404, detail=\"Project not found\")\n    project_tasks = [t for t in tasks.values() if t[\"project_id\"] == project_id]\n    done_count = sum(1 for t in project_tasks if t[\"status\"] == \"done\")\n    total = len(project_tasks)\n    progress = (done_count / total * 100) if total > 0 else 0.0\n    projects[project_id][\"progress_percentage\"] = progress\n    return project_tasks\n\n@app.delete(\"/api/tasks/{task_id}\")\ndef delete_task(task_id: str):\n    if task_id not in tasks:\n        raise HTTPException(status_code=404, detail=\"Task not found\")\n    del tasks[task_id]\n    return {\"message\": \"Task deleted\"}\n\n@app.get(\"/api/users\")\ndef get_users():\n    return list(users.values())",
      "description": "Main FastAPI app with CORS, in-memory storage, core endpoints, enhanced TaskUpdate validation, and user management"
    }
  ],
  "setup_instructions": "pip install fastapi uvicorn && uvicorn main:app --reload"
}