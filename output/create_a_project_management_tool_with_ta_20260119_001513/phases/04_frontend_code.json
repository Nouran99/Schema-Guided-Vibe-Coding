{
  "files": [
    {
      "filename": "index.html",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Project Manager</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        .container { max-width: 800px; margin: auto; }\n        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }\n        input, select, button { margin: 5px; padding: 8px; }\n        .task { background: #f9f9f9; padding: 10px; margin: 5px 0; border-left: 4px solid #007bff; cursor: move; }\n        .overdue { border-left-color: #dc3545; }\n        .kanban { display: flex; gap: 10px; }\n        .column { flex: 1; background: #e9ecef; padding: 10px; border-radius: 5px; min-height: 200px; }\n        .column h3 { text-align: center; }\n        .error { color: #dc3545; margin: 5px; }\n        .success { color: #28a745; margin: 5px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Project Manager</h1>\n        \n        <div class=\"section\">\n            <h2>Create Project</h2>\n            <input id=\"projectName\" placeholder=\"Project name\">\n            <button onclick=\"createProject()\">Create</button>\n            <div id=\"projectMsg\"></div>\n        </div>\n        \n        <div class=\"section\">\n            <h2>Projects</h2>\n            <div id=\"projects\">Loading...</div>\n        </div>\n        \n        <div class=\"section\">\n            <h2>Add Task</h2>\n            <input id=\"taskTitle\" placeholder=\"Task title\">\n            <input id=\"taskDesc\" placeholder=\"Description\">\n            <input id=\"taskDeadline\" type=\"date\">\n            <select id=\"taskProject\"><option>Select project</option></select>\n            <select id=\"taskAssignee\"><option>Select assignee</option></select>\n            <button onclick=\"addTask()\">Add Task</button>\n            <div id=\"taskMsg\"></div>\n        </div>\n        \n        <div class=\"section\">\n            <h2>Kanban Board</h2>\n            <button onclick=\"loadKanban()\">Refresh</button>\n            <div class=\"kanban\">\n                <div class=\"column\"><h3>Todo</h3><div id=\"todo\" ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"></div></div>\n                <div class=\"column\"><h3>In Progress</h3><div id=\"progress\" ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"></div></div>\n                <div class=\"column\"><h3>Done</h3><div id=\"done\" ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"></div></div>\n            </div>\n        </div>\n        \n        <div class=\"section\">\n            <h2>Filter Tasks</h2>\n            <select id=\"filterAssignee\" onchange=\"filterTasks()\">\n                <option value=\"\">All assignees</option>\n            </select>\n            <div id=\"filteredTasks\"></div>\n        </div>\n    </div>\n    \n    <script>\n        const API_BASE = 'http://localhost:8000';\n        let tasks = [], users = [], projects = [];\n        \n        function allowDrop(e) { e.preventDefault(); }\n        function drag(e) { e.dataTransfer.setData('text', e.target.id); }\n        function drop(e) {\n            e.preventDefault();\n            const taskId = e.dataTransfer.getData('text').replace('task', '');\n            const newStatus = e.target.id || e.target.parentElement.id;\n            if (['todo','progress','done'].includes(newStatus)) updateTaskStatus(taskId, newStatus);\n        }\n        \n        function showMsg(element, msg, isError = false) {\n            element.innerHTML = `<span class=\"${isError ? 'error' : 'success'}\">${msg}</span>`;\n            setTimeout(() => element.innerHTML = '', 3000);\n        }\n        \n        async function fetchData(endpoint) {\n            try {\n                const res = await fetch(`${API_BASE}${endpoint}`);\n                if (!res.ok) throw new Error(`HTTP ${res.status}`);\n                return await res.json();\n            } catch (err) { console.error(err); return []; }\n        }\n        \n        async function loadUsers() {\n            users = await fetchData('/api/users');\n            const assigneeSelect = document.getElementById('taskAssignee');\n            const filterSelect = document.getElementById('filterAssignee');\n            assigneeSelect.innerHTML = filterSelect.innerHTML = '<option value=\"\">Select assignee</option>';\n            users.forEach(u => {\n                const opt1 = document.createElement('option');\n                opt1.value = u.id; opt1.textContent = u.username;\n                assigneeSelect.appendChild(opt1);\n                const opt2 = document.createElement('option');\n                opt2.value = u.id; opt2.textContent = u.username;\n                filterSelect.appendChild(opt2);\n            });\n        }\n        \n        async function createProject() {\n            const name = document.getElementById('projectName').value;\n            if (!name) return showMsg(document.getElementById('projectMsg'), 'Enter project name', true);\n            try {\n                await fetch(`${API_BASE}/api/projects`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ name })\n                });\n                showMsg(document.getElementById('projectMsg'), 'Project created');\n                loadProjects();\n            } catch (err) { showMsg(document.getElementById('projectMsg'), 'Failed to create project', true); }\n        }\n        \n        async function loadProjects() {\n            projects = await fetchData('/api/projects');\n            const select = document.getElementById('taskProject');\n            select.innerHTML = '<option>Select project</option>';\n            projects.forEach(p => {\n                const opt = document.createElement('option');\n                opt.value = p.id; opt.textContent = p.name;\n                select.appendChild(opt);\n            });\n            document.getElementById('projects').innerHTML = projects.map(p => \n                `<div>${p.name} - ${p.progress_percentage}%</div>`).join('');\n        }\n        \n        async function addTask() {\n            const title = document.getElementById('taskTitle').value;\n            const projectId = document.getElementById('taskProject').value;\n            if (!title || !projectId) return showMsg(document.getElementById('taskMsg'), 'Fill required fields', true);\n            try {\n                await fetch(`${API_BASE}/api/projects/${projectId}/tasks`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        title,\n                        description: document.getElementById('taskDesc').value,\n                        deadline: document.getElementById('taskDeadline').value,\n                        assignee_id: document.getElementById('taskAssignee').value || null,\n                        status: 'todo'\n                    })\n                });\n                showMsg(document.getElementById('taskMsg'), 'Task added');\n                loadKanban();\n            } catch (err) { showMsg(document.getElementById('taskMsg'), 'Failed to add task', true); }\n        }\n        \n        async function updateTaskStatus(taskId, status) {\n            try {\n                await fetch(`${API_BASE}/api/tasks/${taskId}`, {\n                    method: 'PUT',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ status })\n                });\n                loadKanban();\n            } catch (err) { console.error('Update failed:', err); }\n        }\n        \n        async function loadKanban() {\n            tasks = await fetchData('/api/tasks');\n            ['todo', 'progress', 'done'].forEach(status => {\n                const col = document.getElementById(status);\n                col.innerHTML = tasks.filter(t => t.status === status).map(task => {\n                    const assignee = users.find(u => u.id === task.assignee_id);\n                    const overdue = task.deadline && new Date(task.deadline) < new Date();\n                    return `<div class=\"task ${overdue ? 'overdue' : ''}\" id=\"task${task.id}\" draggable=\"true\" ondragstart=\"drag(event)\">\n                        ${task.title} - ${assignee ? assignee.username : 'Unassigned'}\n                    </div>`;\n                }).join('');\n            });\n            filterTasks();\n        }\n        \n        function filterTasks() {\n            const assigneeId = document.getElementById('filterAssignee').value;\n            const filtered = assigneeId ? tasks.filter(t => t.assignee_id == assigneeId) : tasks;\n            document.getElementById('filteredTasks').innerHTML = filtered.map(t => {\n                const assignee = users.find(u => u.id === t.assignee_id);\n                const overdue = t.deadline && new Date(t.deadline) < new Date();\n                return `<div class=\"task ${overdue ? 'overdue' : ''}\">${t.title} - Assignee: ${assignee ? assignee.username : 'None'}</div>`;\n            }).join('');\n        }\n        \n        window.onload = () => { loadUsers(); loadProjects(); loadKanban(); setInterval(loadKanban, 10000); };\n    </script>\n</body>\n</html>",
      "description": "Updated main HTML page with user name display, error handling, real-time polling, and improved UI"
    }
  ],
  "setup_instructions": "Open index.html in browser after starting the backend with: pip install fastapi uvicorn && uvicorn main:app --reload"
}