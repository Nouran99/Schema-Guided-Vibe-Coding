{
  "files": [
    {
      "filename": "index.html",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Inventory Manager</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        h1 { color: #333; }\n        .section { margin-bottom: 20px; }\n        input, button, select, textarea { margin: 5px; padding: 8px; }\n        table { border-collapse: collapse; width: 100%; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #f2f2f2; }\n        .low-stock { background-color: #ffcccc; }\n        .error { color: red; font-size: 12px; }\n        .filter-row { margin: 10px 0; }\n    </style>\n</head>\n<body>\n    <h1>Inventory Manager</h1>\n    <div class=\"section\">\n        <h2>Products</h2>\n        <input id=\"productName\" placeholder=\"Product Name\" required>\n        <textarea id=\"productDescription\" placeholder=\"Description\" rows=\"2\"></textarea>\n        <input id=\"productPrice\" placeholder=\"Price\" type=\"number\" min=\"0\" step=\"0.01\" required>\n        <input id=\"productThreshold\" placeholder=\"Low Stock Threshold\" type=\"number\" min=\"0\" required>\n        <select id=\"productSupplier\"><option value=\"\">Select Supplier</option></select>\n        <button onclick=\"addProduct()\">Add Product</button>\n        <button onclick=\"loadProducts()\">Load Products</button>\n        <div class=\"filter-row\">\n            <input id=\"searchName\" placeholder=\"Search by name\" oninput=\"searchProducts()\">\n            <select id=\"filterSupplier\" onchange=\"searchProducts()\"><option value=\"\">All Suppliers</option></select>\n            <select id=\"filterStock\" onchange=\"searchProducts()\">\n                <option value=\"\">All Stock</option>\n                <option value=\"low\">Low Stock Only</option>\n            </select>\n        </div>\n        <div id=\"productError\" class=\"error\"></div>\n        <table id=\"productsTable\">\n            <thead><tr><th>ID</th><th>Name</th><th>Description</th><th>Price</th><th>Threshold</th><th>Supplier</th><th>Current Stock</th><th>Status</th><th>Actions</th></tr></thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    <div class=\"section\">\n        <h2>Suppliers</h2>\n        <input id=\"supplierName\" placeholder=\"Supplier Name\" required>\n        <input id=\"supplierContact\" placeholder=\"Contact Info\" required>\n        <button onclick=\"addSupplier()\">Add Supplier</button>\n        <button onclick=\"loadSuppliers()\">Load Suppliers</button>\n        <table id=\"suppliersTable\">\n            <thead><tr><th>ID</th><th>Name</th><th>Contact</th></tr></thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    <div class=\"section\">\n        <h2>Stock Movement</h2>\n        <input id=\"movementProductId\" placeholder=\"Product ID\" type=\"number\" min=\"1\" required>\n        <input id=\"movementQuantity\" placeholder=\"Quantity\" type=\"number\" required>\n        <input id=\"movementSupplierId\" placeholder=\"Supplier ID\" type=\"number\" min=\"1\">\n        <select id=\"movementType\">\n            <option value=\"purchase\">Purchase</option>\n            <option value=\"sale\">Sale</option>\n        </select>\n        <button onclick=\"addStockMovement()\">Record Movement</button>\n        <button onclick=\"loadMovements()\">View History</button>\n        <table id=\"movementsTable\">\n            <thead><tr><th>ID</th><th>Product</th><th>Type</th><th>Quantity</th><th>Supplier</th><th>Date</th></tr></thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    <div class=\"section\">\n        <h2>Inventory Valuation</h2>\n        <button onclick=\"getValuation()\">Get Valuation Report</button>\n        <div id=\"valuationResult\"></div>\n    </div>\n    <script>\n        const API_BASE = 'http://localhost:8000/api';\n        let suppliers = [];\n        async function fetchAPI(endpoint, options = {}) {\n            try {\n                const res = await fetch(`${API_BASE}${endpoint}`, {\n                    headers: { 'Content-Type': 'application/json' },\n                    ...options\n                });\n                return await res.json();\n            } catch (err) {\n                console.error('API Error:', err);\n                alert('API call failed');\n            }\n        }\n        async function loadSuppliers() {\n            suppliers = await fetchAPI('/suppliers');\n            const select = document.getElementById('productSupplier');\n            const filterSelect = document.getElementById('filterSupplier');\n            select.innerHTML = '<option value=\"\">Select Supplier</option>' + suppliers.map(s => `<option value=\"${s.id}\">${s.name}</option>`).join('');\n            filterSelect.innerHTML = '<option value=\"\">All Suppliers</option>' + suppliers.map(s => `<option value=\"${s.id}\">${s.name}</option>`).join('');\n            const tbody = document.querySelector('#suppliersTable tbody');\n            tbody.innerHTML = suppliers.map(s => `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.contact_info}</td></tr>`).join('');\n        }\n        async function loadProducts() {\n            const products = await fetchAPI('/products');\n            renderProducts(products);\n        }\n        async function searchProducts() {\n            const name = document.getElementById('searchName').value;\n            const supplierId = document.getElementById('filterSupplier').value;\n            const stockFilter = document.getElementById('filterStock').value;\n            let url = '/products?'; \n            if (name) url += `name=${name}&`;\n            if (supplierId) url += `supplier_id=${supplierId}&`;\n            if (stockFilter === 'low') url += 'low_stock=true&';\n            const products = await fetchAPI(url);\n            renderProducts(products);\n        }\n        function renderProducts(products) {\n            const tbody = document.querySelector('#productsTable tbody');\n            tbody.innerHTML = products.map(p => {\n                const supplier = suppliers.find(s => s.id === p.primary_supplier_id);\n                const isLow = p.current_stock <= p.low_stock_threshold;\n                return `<tr class=\"${isLow ? 'low-stock' : ''}\"><td>${p.id}</td><td>${p.name}</td><td>${p.description || ''}</td><td>${p.unit_price}</td><td>${p.low_stock_threshold}</td><td>${supplier ? supplier.name : 'None'}</td><td>${p.current_stock}</td><td>${isLow ? 'LOW STOCK!' : 'OK'}</td><td><button onclick=\"editProduct(${p.id})\">Edit</button> <button onclick=\"deleteProduct(${p.id})\">Delete</button></td></tr>`;\n            }).join('');\n        }\n        async function addProduct() {\n            const name = document.getElementById('productName').value;\n            const description = document.getElementById('productDescription').value;\n            const price = parseFloat(document.getElementById('productPrice').value);\n            const threshold = parseInt(document.getElementById('productThreshold').value);\n            const supplierId = parseInt(document.getElementById('productSupplier').value) || null;\n            if (!name || price < 0 || threshold < 0) {\n                document.getElementById('productError').textContent = 'Please fill all required fields correctly.';\n                return;\n            }\n            await fetchAPI('/products', {\n                method: 'POST',\n                body: JSON.stringify({ name, description, unit_price: price, low_stock_threshold: threshold, primary_supplier_id: supplierId })\n            });\n            document.getElementById('productError').textContent = '';\n            loadProducts();\n        }\n        async function editProduct(id) {\n            const newName = prompt('Enter new product name:');\n            if (newName) {\n                await fetchAPI(`/products/${id}`, {\n                    method: 'PUT',\n                    body: JSON.stringify({ name: newName })\n                });\n                loadProducts();\n            }\n        }\n        async function deleteProduct(id) {\n            await fetchAPI(`/products/${id}`, { method: 'DELETE' });\n            loadProducts();\n        }\n        async function addSupplier() {\n            const name = document.getElementById('supplierName').value;\n            const contact = document.getElementById('supplierContact').value;\n            if (!name || !contact) return alert('Please fill all fields');\n            await fetchAPI('/suppliers', {\n                method: 'POST',\n                body: JSON.stringify({ name, contact_info: contact })\n            });\n            loadSuppliers();\n        }\n        async function addStockMovement() {\n            const productId = parseInt(document.getElementById('movementProductId').value);\n            const quantity = parseInt(document.getElementById('movementQuantity').value);\n            const supplierId = parseInt(document.getElementById('movementSupplierId').value) || null;\n            const type = document.getElementById('movementType').value;\n            if (!productId || !quantity || quantity <= 0) return alert('Please fill required fields with positive quantity');\n            await fetchAPI('/stock_movements', {\n                method: 'POST',\n                body: JSON.stringify({ product_id: productId, quantity, movement_type: type, supplier_id: supplierId })\n            });\n            alert('Movement recorded');\n            loadProducts();\n        }\n        async function loadMovements() {\n            const data = await fetchAPI('/stock_movements');\n            const tbody = document.querySelector('#movementsTable tbody');\n            tbody.innerHTML = data.map(m => `<tr><td>${m.id}</td><td>${m.product_id}</td><td>${m.movement_type}</td><td>${m.quantity}</td><td>${m.supplier_id || 'None'}</td><td>${new Date(m.created_at).toLocaleDateString()}</td></tr>`).join('');\n        }\n        async function getValuation() {\n            const data = await fetchAPI('/inventory_valuation');\n            document.getElementById('valuationResult').innerHTML = `<p><strong>Total Inventory Value:</strong> $${data.total_value || '0.00'}</p>`;\n        }\n        loadSuppliers();\n        loadProducts();\n    </script>\n</body>\n</html>",
      "description": "Main HTML page with product description field, edit capability, and improved validation"
    }
  ],
  "setup_instructions": "Open index.html in browser after starting the backend with: pip install fastapi uvicorn && uvicorn main:app --reload"
}