{
  "files": [
    {
      "filename": "index.html",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Weather Dashboard</title>\n    <style>\n        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f0f8ff; }\n        h1 { color: #333; }\n        .search { display: flex; gap: 10px; margin-bottom: 20px; }\n        input, button { padding: 10px; font-size: 16px; }\n        button { background: #4CAF50; color: white; border: none; cursor: pointer; }\n        button:hover { background: #45a049; }\n        .current, .forecast, .favorites { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }\n        .forecast-day { display: inline-block; margin: 10px; text-align: center; }\n        .favorite-item { margin: 5px 0; }\n        .error { color: red; margin: 10px 0; }\n    </style>\n</head>\n<body>\n    <h1>Weather Dashboard</h1>\n    <div class=\"search\">\n        <input type=\"text\" id=\"cityInput\" placeholder=\"Enter city name\">\n        <button onclick=\"searchCity()\">Search</button>\n        <button onclick=\"toggleUnit()\">Toggle \u00b0C/\u00b0F</button>\n    </div>\n    <div id=\"error\" class=\"error\"></div>\n    <div id=\"currentWeather\" class=\"current\">Search a city to see weather.</div>\n    <div id=\"forecast\" class=\"forecast\">5-day forecast will appear here.</div>\n    <div class=\"favorites\">\n        <h3>Favorites</h3>\n        <button onclick=\"loadFavorites()\">Load Favorites</button>\n        <button onclick=\"saveFavorite()\">Save Current as Favorite</button>\n        <div id=\"favoritesList\"></div>\n    </div>\n    <script>\n        let currentCity = null;\n        let unit = 'C';\n        let currentWeatherData = null;\n        let forecastData = null;\n        function showError(msg) { document.getElementById('error').textContent = msg; }\n        function clearError() { showError(''); }\n        async function searchCity() {\n            const city = document.getElementById('cityInput').value.trim();\n            if (!city) { showError('Please enter a city name'); return; }\n            clearError();\n            try {\n                const res = await fetch(`/api/cities/search?q=${encodeURIComponent(city)}`);\n                if (!res.ok) throw new Error('Search failed');\n                const cities = await res.json();\n                if (cities.length > 0) {\n                    currentCity = cities[0];\n                    await fetchWeather();\n                } else showError('City not found');\n            } catch (e) { showError('Error searching city'); console.error(e); }\n        }\n        function convertTemp(temp, fromUnit, toUnit) {\n            if (fromUnit === toUnit) return temp;\n            if (fromUnit === 'C' && toUnit === 'F') return (temp * 9/5) + 32;\n            if (fromUnit === 'F' && toUnit === 'C') return (temp - 32) * 5/9;\n            return temp;\n        }\n        async function fetchWeather() {\n            if (!currentCity) return;\n            clearError();\n            try {\n                const currentRes = await fetch(`/api/weather/current?city_id=${currentCity.id}`);\n                if (!currentRes.ok) throw new Error('Current weather fetch failed');\n                currentWeatherData = await currentRes.json();\n                const forecastRes = await fetch(`/api/weather/forecast?city_id=${currentCity.id}`);\n                if (!forecastRes.ok) throw new Error('Forecast fetch failed');\n                forecastData = await forecastRes.json();\n                updateDisplay();\n            } catch (e) { showError('Error fetching weather'); console.error(e); }\n        }\n        function updateDisplay() {\n            if (!currentWeatherData || !forecastData) return;\n            const temp = convertTemp(currentWeatherData.temperature, currentWeatherData.unit, unit).toFixed(1);\n            document.getElementById('currentWeather').innerHTML = `\n                <h2>${currentCity.name}, ${currentCity.country}</h2>\n                <p>${temp}\u00b0${unit} - ${currentWeatherData.conditions} (Humidity: ${currentWeatherData.humidity}%, Wind: ${currentWeatherData.wind_speed} m/s)</p>\n            `;\n            let forecastHTML = '<h3>5-Day Forecast</h3>';\n            forecastData.forEach(day => {\n                const dayTemp = convertTemp(day.temperature, day.unit, unit).toFixed(1);\n                forecastHTML += `\n                    <div class=\"forecast-day\">\n                        <p>${new Date(day.timestamp).toLocaleDateString()}</p>\n                        <p>${dayTemp}\u00b0${unit}</p>\n                        <p>${day.conditions}</p>\n                    </div>\n                `;\n            });\n            document.getElementById('forecast').innerHTML = forecastHTML;\n        }\n        function toggleUnit() {\n            unit = unit === 'C' ? 'F' : 'C';\n            fetch('/api/weather/unit', { method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({unit}) });\n            if (currentWeatherData) updateDisplay();\n        }\n        async function saveFavorite() {\n            if (!currentCity) { showError('No city selected'); return; }\n            clearError();\n            try {\n                const res = await fetch('/api/favorites', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({city_id: currentCity.id}) });\n                if (!res.ok) throw new Error('Save failed');\n                alert('Saved to favorites');\n            } catch (e) { showError('Error saving favorite'); console.error(e); }\n        }\n        async function loadFavorites() {\n            clearError();\n            try {\n                const res = await fetch('/api/favorites');\n                if (!res.ok) throw new Error('Load failed');\n                const favorites = await res.json();\n                let list = '<h4>Favorite Cities</h4>';\n                favorites.forEach(fav => {\n                    list += `<div class=\"favorite-item\">${fav.city_name} (${fav.country}) <button onclick=\"removeFavorite(${fav.id})\">Remove</button></div>`;\n                });\n                document.getElementById('favoritesList').innerHTML = list;\n            } catch (e) { showError('Error loading favorites'); console.error(e); }\n        }\n        async function removeFavorite(id) {\n            try {\n                const res = await fetch(`/api/favorites/${id}`, { method: 'DELETE' });\n                if (!res.ok) throw new Error('Delete failed');\n                loadFavorites();\n            } catch (e) { showError('Error removing favorite'); console.error(e); }\n        }\n    </script>\n</body>\n</html>",
      "description": "Main HTML page with weather dashboard UI, fixed unit toggle and added error handling"
    }
  ],
  "setup_instructions": "Open index.html in browser (ensure backend API is running at localhost:8000 for fetch calls to work)"
}