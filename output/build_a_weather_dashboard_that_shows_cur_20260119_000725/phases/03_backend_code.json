{
  "files": [
    {
      "filename": "main.py",
      "content": "from fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel\nfrom typing import List\nfrom datetime import datetime, timedelta\nimport random\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\ncities_db = [\n    {\"id\": 1, \"name\": \"London\", \"country\": \"UK\", \"lat\": 51.5074, \"lon\": -0.1278},\n    {\"id\": 2, \"name\": \"New York\", \"country\": \"US\", \"lat\": 40.7128, \"lon\": -74.0060},\n    {\"id\": 3, \"name\": \"Tokyo\", \"country\": \"JP\", \"lat\": 35.6762, \"lon\": 139.6503},\n]\n\nweather_db = {}\nfavorites_db = []\nunit_pref = \"C\"\n\nclass City(BaseModel):\n    id: int\n    name: str\n    country: str\n    lat: float\n    lon: float\n\nclass Weather(BaseModel):\n    city_id: int\n    temperature: float\n    conditions: str\n    humidity: int\n    wind_speed: float\n    icon: str\n    unit: str\n    timestamp: datetime\n\nclass FavoriteOut(BaseModel):\n    id: int\n    user_id: int\n    city_id: int\n    city_name: str\n    country: str\n    created_at: datetime\n\nclass UnitToggle(BaseModel):\n    unit: str\n\n@app.get(\"/api/cities/search\")\nasync def search_cities(q: str) -> List[City]:\n    return [city for city in cities_db if q.lower() in city[\"name\"].lower()]\n\n@app.get(\"/api/weather/current\")\nasync def get_current_weather(city_id: int) -> Weather:\n    city = next((c for c in cities_db if c[\"id\"] == city_id), None)\n    if not city:\n        raise HTTPException(status_code=404, detail=\"City not found\")\n    if city_id not in weather_db:\n        temp = round(random.uniform(5, 30), 1)\n        weather_db[city_id] = {\n            \"city_id\": city_id,\n            \"temperature\": temp,\n            \"conditions\": random.choice([\"Sunny\", \"Cloudy\", \"Rainy\", \"Snowy\"]),\n            \"humidity\": random.randint(30, 90),\n            \"wind_speed\": round(random.uniform(0, 15), 1),\n            \"icon\": random.choice([\"\u2600\ufe0f\", \"\u2601\ufe0f\", \"\ud83c\udf27\ufe0f\", \"\u2744\ufe0f\"]),\n            \"unit\": unit_pref,\n            \"timestamp\": datetime.now()\n        }\n    return weather_db[city_id]\n\n@app.get(\"/api/weather/forecast\")\nasync def get_forecast(city_id: int) -> List[Weather]:\n    city = next((c for c in cities_db if c[\"id\"] == city_id), None)\n    if not city:\n        raise HTTPException(status_code=404, detail=\"City not found\")\n    forecast = []\n    for i in range(5):\n        day = datetime.now() + timedelta(days=i)\n        forecast.append({\n            \"city_id\": city_id,\n            \"temperature\": round(random.uniform(5, 30), 1),\n            \"conditions\": random.choice([\"Sunny\", \"Cloudy\", \"Rainy\", \"Snowy\"]),\n            \"humidity\": random.randint(30, 90),\n            \"wind_speed\": round(random.uniform(0, 15), 1),\n            \"icon\": random.choice([\"\u2600\ufe0f\", \"\u2601\ufe0f\", \"\ud83c\udf27\ufe0f\", \"\u2744\ufe0f\"]),\n            \"unit\": unit_pref,\n            \"timestamp\": day\n        })\n    return forecast\n\n@app.post(\"/api/favorites\")\nasync def add_favorite(city_id: int, user_id: int = 1):\n    city = next((c for c in cities_db if c[\"id\"] == city_id), None)\n    if not city:\n        raise HTTPException(status_code=404, detail=\"City not found\")\n    fav_id = max([f[\"id\"] for f in favorites_db], default=0) + 1\n    favorite = {\"id\": fav_id, \"user_id\": user_id, \"city_id\": city_id, \"created_at\": datetime.now()}\n    favorites_db.append(favorite)\n    return favorite\n\n@app.get(\"/api/favorites\")\nasync def get_favorites(user_id: int = 1) -> List[FavoriteOut]:\n    result = []\n    for fav in favorites_db:\n        if fav[\"user_id\"] == user_id:\n            city = next((c for c in cities_db if c[\"id\"] == fav[\"city_id\"]), None)\n            if city:\n                result.append({\n                    \"id\": fav[\"id\"],\n                    \"user_id\": fav[\"user_id\"],\n                    \"city_id\": fav[\"city_id\"],\n                    \"city_name\": city[\"name\"],\n                    \"country\": city[\"country\"],\n                    \"created_at\": fav[\"created_at\"]\n                })\n    return result\n\n@app.delete(\"/api/favorites/{fav_id}\")\nasync def delete_favorite(fav_id: int):\n    global favorites_db\n    favorites_db = [f for f in favorites_db if f[\"id\"] != fav_id]\n    return {\"message\": \"Favorite deleted\"}\n\n@app.put(\"/api/weather/unit\")\nasync def toggle_unit(toggle: UnitToggle):\n    global unit_pref\n    unit_pref = toggle.unit if toggle.unit in [\"C\", \"F\"] else \"C\"\n    return {\"unit\": unit_pref}\n",
      "description": "Main FastAPI app with CORS, in-memory storage, and core endpoints for weather dashboard - updated to include city details in favorites response"
    }
  ],
  "setup_instructions": "pip install fastapi uvicorn && uvicorn main:app --reload"
}