{
  "files": [
    {
      "filename": "main.py",
      "content": "from fastapi import FastAPI, HTTPException\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel\nfrom datetime import datetime\nimport uuid\n\napp = FastAPI()\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# In-memory storage\ncourses = {}\nlessons = {}\nquizzes = {}\nenrollments = {}\n\n# Models\nclass CourseCreate(BaseModel):\n    instructor_id: int\n    title: str\n    description: str\n\nclass LessonCreate(BaseModel):\n    title: str\n    content_type: str\n    content_url: str\n    order: int\n\nclass QuizCreate(BaseModel):\n    title: str\n    questions: list\n    passing_score: int\n\nclass EnrollmentCreate(BaseModel):\n    learner_id: int\n\nclass ProgressUpdate(BaseModel):\n    progress_percent: int\n\nclass QuizSubmission(BaseModel):\n    answers: dict\n\n# Core endpoints\n@app.get(\"/api/courses\")\ndef list_courses():\n    return list(courses.values())\n\n@app.post(\"/api/courses\")\ndef create_course(course: CourseCreate):\n    course_id = str(uuid.uuid4())\n    courses[course_id] = {\n        \"id\": course_id,\n        \"instructor_id\": course.instructor_id,\n        \"title\": course.title,\n        \"description\": course.description,\n        \"created_at\": datetime.now().isoformat()\n    }\n    return courses[course_id]\n\n@app.post(\"/api/courses/{course_id}/lessons\")\ndef add_lesson(course_id: str, lesson: LessonCreate):\n    if course_id not in courses:\n        raise HTTPException(status_code=404, detail=\"Course not found\")\n    lesson_id = str(uuid.uuid4())\n    lessons[lesson_id] = {\n        \"id\": lesson_id,\n        \"course_id\": course_id,\n        \"title\": lesson.title,\n        \"content_type\": lesson.content_type,\n        \"content_url\": lesson.content_url,\n        \"order\": lesson.order,\n        \"is_completed\": False\n    }\n    return lessons[lesson_id]\n\n@app.post(\"/api/lessons/{lesson_id}/quiz\")\ndef create_quiz(lesson_id: str, quiz: QuizCreate):\n    if lesson_id not in lessons:\n        raise HTTPException(status_code=404, detail=\"Lesson not found\")\n    quiz_id = str(uuid.uuid4())\n    quizzes[quiz_id] = {\n        \"id\": quiz_id,\n        \"lesson_id\": lesson_id,\n        \"title\": quiz.title,\n        \"questions\": quiz.questions,\n        \"passing_score\": quiz.passing_score\n    }\n    return quizzes[quiz_id]\n\n@app.post(\"/api/quizzes/{quiz_id}/submit\")\ndef submit_quiz(quiz_id: str, submission: QuizSubmission):\n    if quiz_id not in quizzes:\n        raise HTTPException(status_code=404, detail=\"Quiz not found\")\n    quiz = quizzes[quiz_id]\n    # Simple auto-grading\n    correct = 0\n    for q in quiz[\"questions\"]:\n        if q.get(\"correct_answer\") == submission.answers.get(str(q.get(\"id\"))):\n            correct += 1\n    score = int((correct / len(quiz[\"questions\"])) * 100) if quiz[\"questions\"] else 0\n    passed = score >= quiz[\"passing_score\"]\n    return {\"score\": score, \"passed\": passed, \"correct\": correct, \"total\": len(quiz[\"questions\"])}\n\n@app.put(\"/api/lessons/{lesson_id}/complete\")\ndef mark_lesson_complete(lesson_id: str):\n    if lesson_id not in lessons:\n        raise HTTPException(status_code=404, detail=\"Lesson not found\")\n    lessons[lesson_id][\"is_completed\"] = True\n    return lessons[lesson_id]\n\n@app.post(\"/api/courses/{course_id}/enroll\")\ndef enroll_course(course_id: str, enrollment: EnrollmentCreate):\n    if course_id not in courses:\n        raise HTTPException(status_code=404, detail=\"Course not found\")\n    enrollment_id = str(uuid.uuid4())\n    enrollments[enrollment_id] = {\n        \"id\": enrollment_id,\n        \"learner_id\": enrollment.learner_id,\n        \"course_id\": course_id,\n        \"progress_percent\": 0,\n        \"completed_at\": None,\n        \"certificate_url\": None\n    }\n    return enrollments[enrollment_id]\n\n@app.get(\"/api/learners/{learner_id}/dashboard\")\ndef get_dashboard(learner_id: int):\n    learner_enrollments = [e for e in enrollments.values() if e[\"learner_id\"] == learner_id]\n    dashboard = []\n    for e in learner_enrollments:\n        course = courses.get(e[\"course_id\"], {})\n        dashboard.append({\n            \"course_id\": e[\"course_id\"],\n            \"course_title\": course.get(\"title\", \"Unknown\"),\n            \"progress_percent\": e[\"progress_percent\"],\n            \"completed_at\": e[\"completed_at\"],\n            \"certificate_url\": e[\"certificate_url\"]\n        })\n    return {\"learner_id\": learner_id, \"enrollments\": dashboard}",
      "description": "Main FastAPI app with 4 core endpoints: courses, lessons, quizzes, enrollments, plus quiz creation and auto-grading"
    }
  ],
  "setup_instructions": "pip install fastapi uvicorn && uvicorn main:app --reload"
}